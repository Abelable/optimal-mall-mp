<view class="navigation-bar row" style="padding-top: {{statusBarHeight}}px;">
  <view style="flex: 1;">
    <view class="nav-bar-btn row">
      <image class="nav-back-icon" bindtap="navBack" src="https://img.ubo.vip/mp/i-back-icon/back-icon.png" />
      <view class="edit-btn" wx:if="{{cartList.length}}" bindtap="toggleDeleteBtnVisible">{{deleteBtnVisible ? '完成' : '管理'}}</view>
    </view>
  </view>
  <view class="navigation-title">购物车</view>
  <view style="flex: 1;"></view>
</view>

<view class="wrap" style="padding-top: {{statusBarHeight + 44}}px;">
  <view class="cart-list-wrap" wx:if="{{cartList.length}}">
    <view class="cart-list" wx:for="{{cartList}}" wx:key="index">
      <view class="cart-list-header">
        <checkbox checked="{{item.checked}}" data-index="{{index}}" bindtap="toggleCartChecked"/>
        <view class="shop-info" wx:if="{{item.shopInfo}}" bindtap="navToShop" data-id="{{item.shopInfo.id}}">
          <image class="shop-img" src="{{item.shopInfo.avatar}}" lazy-load />
          <view>{{item.shopInfo.name}}</view>
          <image style="width: 20rpx; height: 20rpx;" src="https://img.ubo.vip/mp/to-icon.png" />
        </view>
        <view class="shop-info" wx:if="{{!item.shopInfo}}">官方自营</view>
      </view>
      <view class="goods-list-wrap">
        <view wx:for="{{item.goodsList}}" wx:key="index" wx:for-index="_index" wx:for-item="_item">
          <van-swipe-cell bind:close="deleteGoods" data-id="{{_item.id}}" data-cart-index="{{index}}" data-goods-index="{{_index}}" async-close right-width="{{ 65 }}">
            <view class="goods-list row" bindtap="showGoodsDetail" data-id="{{_item.goodsId}}">
              <checkbox checked="{{_item.checked}}" disabled="{{_item.status !== 1}}" bindtap="toggleGoodsChecked" data-cart-index="{{index}}" data-goods-index="{{_index}}"/>
              <image class="goods-img" src="{{_item.goodsImage}}" mode="aspectFill" lazy-load  />
              <view class="goods-content">
                <view class="goods-name {{_item.status !== 1 ? 'invalid' : ''}}">{{_item.goodsName}}</view>
                <block wx:if="{{_item.status === 1}}">
                  <view class="goods-sku-wrap" wx:if="{{_item.selectedSkuName}}" catchtap="editSpec" data-info="{{_item}}">
                    <text class="goods-sku">已选：{{_item.selectedSkuName}}</text>
                    <image class="sku-edit-icon" src="https://img.ubo.vip/mp/to-icon.png" />
                  </view>
                  <view class="goods-price-wrap">
                    <view class="goods-price row baseline">
                      <price-unit price="{{_item.price}}" />
                      <view class="price-market" wx:if="{{_item.marketPrice}}">¥{{_item.marketPrice}}</view>
                    </view>
                    <van-stepper value="{{ _item.number }}" bind:change="countChange" data-cart-index="{{index}}" data-goods-index="{{_index}}" integer max="{{_item.stock}}" />
                  </view>
                </block>
                <view class="invalid-tips-wrap" wx:if="{{_item.status === 2}}">
                  <view class="invalid-tips">请重新选择规格</view>
                  <view class="reset-spec-btn" bindtap="editSpec" data-info="{{_item}}">重选</view>
                </view>
              </view>
            </view>
            <button class="swipe-cell-delete-btn" slot="right">删除</button>
          </van-swipe-cell>
        </view>
      </view>
    </view>
  </view>

  <view class="empty-illus" wx:if="{{!cartList.length}}">
    <view class="empty-desc">还没有宝贝哦，快去挑选喜欢的宝贝吧～</view>
    <navigator class="visit-btn" url="/pages/mall/subpages/goods/index" hover-class="navigator-hover">去逛逛</navigator>
  </view>

  <view class="recommend-goods-wrap" wx:if="{{recommendGoodsList.length}}">
    <split-line desc="猜您喜欢" />
    <fall-flow list="{{recommendGoodsList}}" generic:item="goods-item" />
  </view>

  <view class="nomore-tip" wx:if="{{recommendGoodsList.length}}">～没有更多了～</view>
</view>

<view class="bottom-bar" wx:if="{{cartList.length}}">
  <view class="select-all" bindtap="toggleAllChecked">
    <checkbox checked="{{isSelectAll}}" />
    <view>全选</view>
  </view>
  <view class="bar-main" wx:if="{{!deleteBtnVisible}}">
    <view class="total-price row baseline">
      <text>合计：</text>
      <price-unit price="{{totalPrice}}" fontSize="26rpx" integerPartFontSize="36rpx" />
    </view>
    <button class="submit {{selectedCount ? 'active' : ''}}" bindtap="submit">
      <text>结算</text>
      <text wx:if="{{selectedCount}}">({{selectedCount}})</text>
    </button>
  </view>
  <button class="delete-btn {{selectedCount ? 'active' : ''}}" wx:if="{{deleteBtnVisible}}" bindtap="deleteGoodsList">删除</button>
</view>

<spec-popup show="{{specPopupVisible}}" mode="{{3}}" goodsInfo="{{goodsInfo}}" cartInfo="{{cartInfo}}" bind:hide="finishEdit" />
